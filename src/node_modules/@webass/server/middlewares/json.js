//utility middleware to respond in json.
//usage response.json({info: true, message: "hi"}, httpCode);
//json response pattern {"status": "success|error", "message": "hi", "data": {"info": true}};

function json(data, code) {
  if(!code) code = 200;
  this.res.writeHead(code, {
    'Content-Type': 'application/json'
  });
  var status = 'success';
  if(code >= 400) status = 'error';

  var mess = null;
  if(data.message) {
    mess = data.message + '';
    delete data.message;
  }
  var obj = {
    status: status,
    data: data
  };
  if(mess != null) obj.message = mess;

  this.res.end(JSON.stringify(obj));
}

export default (req, res, next) => {
  res.json = json.bind({res: res});
  next();
};